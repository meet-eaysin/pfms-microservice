generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BudgetPeriod {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

enum TriggerType {
  EXPENSE_CREATED
  INCOME_RECEIVED
  BUDGET_THRESHOLD
  GOAL_MILESTONE
  SCHEDULED
}

enum ActionType {
  SEND_NOTIFICATION
  CONTRIBUTE_TO_GOAL
  CREATE_BUDGET_ALERT
  LOG_EVENT
}

model Budget {
  id          String       @id @default(uuid())
  userId      String
  categoryId  String?
  name        String
  amountLimit Decimal      @db.Decimal(12, 2)
  period      BudgetPeriod
  startDate   DateTime
  endDate     DateTime?
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([userId])
  @@index([userId, period])
  @@index([userId, isActive])
  @@map("budgets")
}

model SavingsGoal {
  id            String             @id @default(uuid())
  userId        String
  name          String
  description   String?
  targetAmount  Decimal            @db.Decimal(12, 2)
  currentAmount Decimal            @db.Decimal(12, 2) @default(0)
  deadline      DateTime?
  isCompleted   Boolean            @default(false)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  
  contributions GoalContribution[]

  @@index([userId])
  @@index([userId, isCompleted])
  @@map("savings_goals")
}

model GoalContribution {
  id        String      @id @default(uuid())
  goalId    String
  goal      SavingsGoal @relation(fields: [goalId], references: [id], onDelete: Cascade)
  amount    Decimal     @db.Decimal(12, 2)
  date      DateTime
  notes     String?
  createdAt DateTime    @default(now())

  @@index([goalId])
  @@index([date])
  @@map("goal_contributions")
}

model AutomationRule {
  id             String      @id @default(uuid())
  userId         String
  name           String
  description    String?
  triggerType    TriggerType
  conditions     Json
  actionType     ActionType
  actionPayload  Json
  isActive       Boolean     @default(true)
  executionCount Int         @default(0)
  lastExecutedAt DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@index([userId])
  @@index([userId, isActive])
  @@index([triggerType, isActive])
  @@map("automation_rules")
}
